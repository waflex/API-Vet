<!doctype html>
<html lang="es">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>API Veterinaria — Documentación</title>
	<style>
		:root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#6ee7b7;--accent2:#60a5fa}
		html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Arial;background:linear-gradient(180deg,#071025 0%, #061227 100%);color:#e6eef6}
		.container{max-width:980px;margin:32px auto;padding:28px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,.6)}
		h1{margin:0 0 6px;font-size:28px}
		p.lead{color:var(--muted);margin-top:0}
		.grid{display:grid;grid-template-columns:1fr 340px;gap:20px;margin-top:20px}
		.card{background:var(--card);padding:18px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
		pre{background:#071427;padding:12px;border-radius:8px;overflow:auto;color:#d6f4ea}
		code{font-family:Consolas,monaco,monospace}
		.endpoint{display:flex;align-items:center;gap:8px;margin-bottom:10px}
		.method{font-weight:700;padding:6px 10px;border-radius:6px;background:rgba(255,255,255,0.04)}
		.method.get{color:var(--accent2)}.method.post{color:var(--accent)}
		.try{margin-top:12px}
		.btn{display:inline-block;padding:8px 12px;border-radius:8px;background:linear-gradient(90deg,#1f2937,#0f1724);color:#e6eef6;text-decoration:none;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
		label{display:block;margin:8px 0 4px;color:var(--muted);font-size:13px}
		input,textarea,select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
		footer{margin-top:18px;color:var(--muted);font-size:13px}
		.ok{color:#8ef0b7}
	</style>
</head>
<body>
	<div class="container">
		<h1>API Veterinaria</h1>
		<p class="lead">Documentación interactiva y ejemplos para la API de mascotas. Basada en <code>main.py</code> — endpoints disponibles: listar, obtener y crear mascotas.</p>

		<div class="grid">
			<div>
				<div class="card">
					<h3>Resumen</h3>
					<p class="lead">La API expone un recurso <code>/mascotas/</code> que soporta:</p>
					<ul>
						<li><strong>GET /mascotas/</strong> — lista todas las mascotas (200)</li>
						<li><strong>GET /mascotas/{id}</strong> — obtiene una mascota por id (200 / 404)</li>
						<li><strong>POST /mascotas/</strong> — crea una mascota y devuelve el objeto con su id (201)</li>
					</ul>

					<h4>Esquema (JSON)</h4>
					<pre><code>{
	"id": integer | null,
	"nombre": "string",
	"especie": "string",
	"edad": integer
}</code></pre>

					<h4>Ejemplo de respuesta (GET /mascotas/)</h4>
					<pre><code>[
	{"id": 1, "nombre": "Firulais", "especie": "Perro", "edad": 4},
	{"id": 2, "nombre": "Misu", "especie": "Gato", "edad": 2}
]</code></pre>

					<h4>Errores</h4>
					<ul>
						<li><code>404</code> — mascota no encontrada</li>
						<li><code>400</code> — payload inválido</li>
					</ul>
				</div>

				<div class="card" style="margin-top:16px">
					<h3>Cómo ejecutar (rápido)</h3>
					<p class="lead">En Docker (desde la raíz del proyecto):</p>
					<pre><code>docker-compose up --build</code></pre>
					<p class="lead">Local (sin Docker):</p>
					<pre><code>set DATABASE_URL=postgresql://alumno:alumno123@localhost:5432/veterinaria; uvicorn main:app --reload</code></pre>

					<p class="lead">Nota: la variable de entorno <code>DATABASE_URL</code> controla la conexión. En Docker debe apuntar al servicio <code>db</code>.</p>
				</div>
			</div>

			<div>
				<div class="card">
					<h3>Probar desde aquí (ejecuta la API en <code>http://localhost:8000</code>)</h3>

					<div>
						<label for="listBtn">Listar mascotas</label>
						<button id="listBtn" class="btn">GET /mascotas/</button>
					</div>

					<div style="margin-top:12px">
						<label for="getId">Obtener por ID</label>
						<input id="getId" placeholder="Ej: 1" />
						<div style="margin-top:8px"><button id="getBtn" class="btn">GET /mascotas/{id}</button></div>
					</div>

					<div style="margin-top:12px">
						<label>Crear mascota (POST)</label>
						<input id="nombre" placeholder="Nombre" />
						<input id="especie" placeholder="Especie" />
						<input id="edad" placeholder="Edad" type="number" />
						<div style="margin-top:8px"><button id="postBtn" class="btn">POST /mascotas/</button></div>
					</div>

					<div class="try" style="margin-top:14px">
						<label>Resultado</label>
						<pre id="result" style="height:200px;overflow:auto;background:#061827;padding:10px;border-radius:8px"></pre>
					</div>

					<footer>Si obtienes errores CORS al usar los botones, abre esta página desde el mismo host donde corre la API o añade CORS a <code>main.py</code>.</footer>
				</div>
			</div>
		</div>

		<section style="margin-top:20px" class="card">
			<h3>Ejemplos rápidos (curl / Python)</h3>
			<h4>Crear mascota — curl</h4>
			<pre><code>curl -X POST http://localhost:8000/mascotas/ \
	-H "Content-Type: application/json" \
	-d '{"nombre":"Luna","especie":"Gato","edad":1}'</code></pre>

			<h4>Listar mascotas — Python (requests)</h4>
			<pre><code>import requests
resp = requests.get('http://localhost:8000/mascotas/')
print(resp.json())</code></pre>

			<h4>Consejos</h4>
			<ul>
				<li>Asegúrate de que el servicio <code>db</code> esté listo antes de que la API intente crear tablas. El proyecto ya incluye reintentos en <code>main.py</code>.</li>
				<li>Para desarrollo local puedes usar el archivo <code>init.sql</code> para poblar datos.</li>
			</ul>
		</section>

	</div>

	<script>
		const base = 'http://localhost:8000';
		const result = document.getElementById('result');
		function show(x){ result.textContent = JSON.stringify(x, null, 2); }

		document.getElementById('listBtn').onclick = async ()=>{
			try{
				const r = await fetch(base + '/mascotas/');
				const j = await r.json(); show({status: r.status, body: j});
			}catch(e){ show({error: e.toString()}); }
		}
		document.getElementById('getBtn').onclick = async ()=>{
			const id = document.getElementById('getId').value.trim(); if(!id){ show('Introduce un id'); return }
			try{ const r = await fetch(base + '/mascotas/' + id); const j = await r.json(); show({status: r.status, body: j}); }catch(e){ show({error: e.toString()}); }
		}
		document.getElementById('postBtn').onclick = async ()=>{
			const nombre = document.getElementById('nombre').value;
			const especie = document.getElementById('especie').value;
			const edad = parseInt(document.getElementById('edad').value||0);
			try{
				const r = await fetch(base + '/mascotas/', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({nombre, especie, edad})});
				const j = await r.json(); show({status: r.status, body: j});
			}catch(e){ show({error: e.toString()}); }
		}
	</script>
</body>
</html>
